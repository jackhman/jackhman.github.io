import{_ as h,F as e,g as l,K as n,h as i,ar as t,l as s,o as p}from"./chunks/framework.VlluEs-f.js";const G=JSON.parse('{"title":"第28讲：深入query-graphql插件，SWRocketbot背后的英雄（上）","description":"","frontmatter":{},"headers":[],"relativePath":"posts/backEnd/098-讲带你搞懂 SkyWalking文档/(1746) 第28讲：深入 query-graphql 插件，SW Rocketbot 背后的英雄（上）.md","filePath":"posts/backEnd/098-讲带你搞懂 SkyWalking文档/(1746) 第28讲：深入 query-graphql 插件，SW Rocketbot 背后的英雄（上）.md","lastUpdated":1718371218000}'),k={name:"posts/backEnd/098-讲带你搞懂 SkyWalking文档/(1746) 第28讲：深入 query-graphql 插件，SW Rocketbot 背后的英雄（上）.md"},r=t("",9),E=t("",5),d=s("h3",{id:"graphql-schema-鸟瞰",tabindex:"-1"},[i("GraphQL Schema 鸟瞰 "),s("a",{class:"header-anchor",href:"#graphql-schema-鸟瞰","aria-label":'Permalink to "GraphQL Schema 鸟瞰"'},"​")],-1),g=s("p",null,"在 resouces/query-protocol 目录中包含了 query-graphql-plugin 插件的全部 GraphQL Schema 文件，其结构如下图所示，该结构图是通过 GraphQL Voyager 工具生成的，如果你感兴趣可以查找相关资料进行了解。",-1),y=s("p",null,"在学习了前面介绍的 GraphQL Schema 基本语法和示例之后，相信你已经完全能够读懂上图涉及的全部 GraphQL Schema 定义，这里就不再一一展开分析，我们将重点放在关联的 Resolver 以及具体的查询实现上。",-1),c=s("h3",{id:"metadataquery",tabindex:"-1"},[i("MetadataQuery "),s("a",{class:"header-anchor",href:"#metadataquery","aria-label":'Permalink to "MetadataQuery"'},"​")],-1),o=s("p",null,"query-graphql-plugin 插件中提供了三个查询 Service 的方法，如下图所示：",-1),u=s("p",null,"GraphQL Java Tools 会将上述三个查询 Service 的方法映射到 MetadataQuery 中的同名方法，如下图所示，MetadataQuery 会将请求委托给 MetadataQueryService 的同名方法处理，而 MetadataQueryService 中也没有其他逻辑，直接将请求委托给 MetadataQueryEsDAO 的同名方法：",-1),F=t("",4),A=t("",11),C=s("ul",null,[s("li",null,[s("p",null,"getValues() 方法：返回一个聚合后的单值，例如，一个 Service 在一段时间内 SLA 的平均值。")]),s("li",null,[s("p",null,"getLinearIntValues() 方法：返回一条时序数据（即每个时间单位一个点，这些连续的点可以组成一张二维的监控图）。")]),s("li",null,[s("p",null,"getThermodynamic() 方法：返回的 heatmap（热力图）。")])],-1),B=s("h4",{id:"查询单个聚合值",tabindex:"-1"},[i("查询单个聚合值 "),s("a",{class:"header-anchor",href:"#查询单个聚合值","aria-label":'Permalink to "查询单个聚合值"'},"​")],-1),D=s("p",null,"首先来看 MetricQuery.getValues() 方法，请求该方法的位置是在 SkyWalking Rocketbot 的拓扑图中，如下图所示：",-1),_=t("",18),m=t("",4),v=t("",3),S=s("p",null,"3、将步骤 2 的查询结果整理成 IntValues（底层是 KVInt 列表），相关代码实现比较简单，不再展示。示例中的整理结果如下图所示，其中每个 KVInt 的 Key 为 Document Id，Value 为相应的 summation 值：",-1),b=s("p",null,"前端拿到上述 KVInt 列表之后，即可绘制出示例中的 Service Response Time 监控图。",-1),q=s("h4",{id:"查询-heatmap",tabindex:"-1"},[i("查询 heatmap "),s("a",{class:"header-anchor",href:"#查询-heatmap","aria-label":'Permalink to "查询 heatmap"'},"​")],-1),Q=s("p",null,"MetricQuery 中最后一个查询方法是 getThermodynamic() 方法，该方法用于查询热力图，具体查询方式与 getLinearIntValues() 方法类似，这里不再展开分析。",-1);function I(T,x,L,P,R,M){const a=e("Image");return p(),l("div",null,[r,n(a,{alt:"Drawing 0.png",src:"https://s0.lgstatic.com/i/image/M00/26/44/CgqCHl7xt6yAHDDLAAIeqgBo9HE860.png"}),i(),E,n(a,{alt:"Drawing 1.png",src:"https://s0.lgstatic.com/i/image/M00/26/38/Ciqc1F7xt76AflHaAANfIPXqD0Q765.png"}),i(),d,g,n(a,{alt:"Drawing 2.png",src:"https://s0.lgstatic.com/i/image/M00/26/39/Ciqc1F7xt8uAa-I6AAjKWi_tgPI783.png"}),i(),y,c,o,n(a,{alt:"Drawing 3.png",src:"https://s0.lgstatic.com/i/image/M00/26/39/Ciqc1F7xt9WABcbdAAI-KmsR4xQ745.png"}),i(),u,n(a,{alt:"Drawing 4.png",src:"https://s0.lgstatic.com/i/image/M00/26/44/CgqCHl7xt92AR6MbAAT0t4jgEsA600.png"}),i(),F,n(a,{alt:"Drawing 5.png",src:"https://s0.lgstatic.com/i/image/M00/26/39/Ciqc1F7xt-uAYJIjAANCIMBQIGg737.png"}),i(),A,n(a,{alt:"Drawing 6.png",src:"https://s0.lgstatic.com/i/image/M00/26/44/CgqCHl7xuAKAGJpGAAEsPKwo6_0843.png"}),i(),C,B,D,n(a,{alt:"Drawing 7.png",src:"https://s0.lgstatic.com/i/image/M00/26/39/Ciqc1F7xuA2AZu34AAD4-d0xhHI072.png"}),i(),_,n(a,{alt:"Drawing 8.png",src:"https://s0.lgstatic.com/i/image/M00/26/3A/Ciqc1F7xuIyAZc4MAABhTIGGqHg410.png"}),i(),m,n(a,{alt:"Drawing 9.png",src:"https://s0.lgstatic.com/i/image/M00/26/45/CgqCHl7xuJmAapVFAAC9IVj0ets069.png"}),i(),v,n(a,{alt:"Drawing 10.png",src:"https://s0.lgstatic.com/i/image/M00/26/3A/Ciqc1F7xuKiAfaUbAAr-NQ2X_L4640.png"}),i(),S,n(a,{alt:"Drawing 11.png",src:"https://s0.lgstatic.com/i/image/M00/26/45/CgqCHl7xuLKAFb6VAAwzofyYQew138.png"}),i(),b,q,Q])}const f=h(k,[["render",I]]);export{G as __pageData,f as default};
